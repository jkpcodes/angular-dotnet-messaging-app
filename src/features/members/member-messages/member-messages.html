<div class="flex flex-col flex-grow overflow-auto h-[calc(100%-48px)]">
  @for (message of messageService.messageThread(); track message.id) {
    <div 
      class="chat"
      [class.chat-start]="!message.currentUserSender"
      [class.chat-end]="message.currentUserSender"
    >
      <div
        class="chat-image avatar"
        [class.avatar-online]="presenceService.onlineUsers()
          .includes(message.senderId || message.recipientId)"
      >
        <div class="w-10 rounded-full">
          <img
            alt="user display image"
            [src]="message.senderImageUrl || '/user.png'"
          />
        </div>
      </div>
      <div class="chat-header">
        {{ message.currentUserSender ? message.recipientDisplayName : message.senderDisplayName }}
        <time class="text-xs opacity-50">{{ message.messageSent | date: 'short' }}</time>
      </div>
      <div class="chat-bubble">{{ message.content }}</div>
      @if (message.currentUserSender && message.dateRead) {
        <div class="chat-footer opacity-50">Seen {{ message.dateRead | timeAgo }}</div>
      } @else if (message.currentUserSender && !message.dateRead) {
        <div class="chat-footer opacity-50">Not read</div>
      } @else {
        <div class="chat-footer opacity-50">Delivered</div>
      }
    </div>
  }
  <div #messageEndRef></div>
</div>
<div class="flex h-[48px] w-full mt-6 join">
  <input type="text"
    [(ngModel)]="messageContent"
    class="input w-full"
    placeholder="Enter message"
    (keydown.enter)="sendMessage()"
  >
  <button (click)="sendMessage()" class="btn btn-primary join-item">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
    </svg>    
  </button>
</div>